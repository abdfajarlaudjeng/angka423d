<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data 2D dengan Validasi</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-6xl mx-auto bg-white rounded-xl shadow-lg p-4">
    <h1 class="text-2xl font-bold mb-4">Data 2D - Google Sheets</h1>

    <!-- Input Angka Main -->
    <div class="mb-4">
      <label for="angkaMain" class="block font-semibold mb-1">Angka Main</label>
      <textarea id="angkaMain" rows="2" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring" placeholder="Pisahkan dengan spasi atau koma"></textarea>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
      <table class="min-w-full border border-gray-300 text-sm">
        <thead id="thead" class="bg-gray-200"></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

  <script>
    const thead = document.getElementById("thead");
    const tbody = document.getElementById("tbody");

    let data = [];
    let sortKey = null;
    let sortDir = "asc";

    async function fetchData() {
      const url = "https://docs.google.com/spreadsheets/d/1tX6qfI_0PhrpmGxz4qqaT0_8YHKhPwE3dPHguPvNFmU/gviz/tq?tqx=out:json&sheet=DATA%202D";
      const res = await fetch(url);
      const text = await res.text();
      const json = JSON.parse(text.substr(47).slice(0, -2));

      data = json.table.rows.map(r => {
        let row = {};
        json.table.cols.forEach((c, i) => {
          if (c && c.label) row[c.label] = r.c[i] ? r.c[i].v : "";
        });
        return row;
      });

      const keys = Object.keys(data[0]);
      buildHeader(keys);
      buildBody(data, keys);
    }

    function buildHeader(keys) {
      thead.innerHTML = "";
      const tr = document.createElement("tr");

      keys.forEach(k => {
        const th = document.createElement("th");
        th.textContent = k;
        th.className = "px-3 py-2 text-left font-semibold border";
        tr.appendChild(th);
      });

      const thValidasi = document.createElement("th");
      thValidasi.textContent = "Validasi";
      thValidasi.className = "px-3 py-2 text-left font-semibold border";
      tr.appendChild(thValidasi);

      thead.appendChild(tr);
    }

    function buildBody(rows, keys) {
      tbody.innerHTML = "";
      rows.forEach(r => {
        const tr = document.createElement("tr");
        keys.forEach(k => {
          const td = document.createElement("td");
          td.textContent = r[k] ?? "";
          td.className = "px-3 py-2 border";
          tr.appendChild(td);
        });

        const tdValidasi = document.createElement("td");
        tdValidasi.textContent = "-";
        tdValidasi.className = "px-3 py-2 border text-center";
        tr.appendChild(tdValidasi);

        tbody.appendChild(tr);
      });
    }

    function cekValidasi() {
      const input = document.getElementById("angkaMain").value;
      const angkaMainList = input.split(/[\s,]+/).map(s => s.trim()).filter(s => s !== "");

      const rows = tbody.querySelectorAll("tr");
      rows.forEach(row => {
        const cells = row.querySelectorAll("td");
        if (cells.length === 0) return;

        const angka2D = cells[0].textContent.trim();
        const cellValidasi = cells[cells.length - 1];

        if (angkaMainList.includes(angka2D)) {
          row.classList.remove("bg-red-100");
          row.classList.add("bg-green-100");
          cellValidasi.textContent = "✅ Cocok";
          cellValidasi.classList.remove("text-red-600");
          cellValidasi.classList.add("text-green-600", "font-semibold");
        } else {
          row.classList.remove("bg-green-100");
          row.classList.add("bg-red-100");
          cellValidasi.textContent = "❌ Tidak Cocok";
          cellValidasi.classList.remove("text-green-600");
          cellValidasi.classList.add("text-red-600", "font-semibold");
        }
      });
    }

    document.getElementById("angkaMain").addEventListener("input", cekValidasi);

    fetchData();
  </script>
</body>
</html>
